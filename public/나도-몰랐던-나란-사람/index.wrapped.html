<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë‚˜ë„ ëª°ëë˜ ë‚˜ë€ ì‚¬ëŒ</title>
    
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700&display=swap');
      body {
        font-family: 'Pretendard', sans-serif;
      }
      /* Custom scrollbar for chat */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
  
<link rel="stylesheet" href="./index.css">
</head>
  <body class="bg-gray-50 text-gray-800">
    <div id="root"></div>
    
  
     <!-- Injected by Generator -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
      window.process = { env: { API_KEY: "AIzaSyDr73mB7NaPI0oIL-xG5mcRM3Clv12hTxQ" } };
    </script>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.2.0",
          "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
          "lucide-react": "https://esm.sh/lucide-react@0.263.1",
          "@google/genai": "https://esm.sh/@google/genai@0.1.1",
          "recharts": "https://esm.sh/recharts@2.12.0"
        }
      }
    </script>
    <script type="text/babel" data-type="module" data-presets="react,typescript">
      
/* --- Bundled from AnalysisView.tsx --- */
import React from 'react';



interface AnalysisViewProps {
  experiences: Experience[];
  isLoading: boolean;
  onNext: () => void;
  onBack: () => void;
}

const AnalysisView: React.FC<AnalysisViewProps> = ({ experiences, isLoading, onNext, onBack }) => {
  return (
    <div className="flex flex-col h-full space-y-4">
      <div className="flex items-center justify-between">
        <button onClick={() => { audioService.playClick(); onBack(); }} className="text-gray-500 hover:text-gray-800 text-sm font-medium">
          &larr; ë’¤ë¡œê°€ê¸°
        </button>
        <h2 className="text-xl font-bold text-gray-800">ë‚˜ì˜ ìˆ¨ê²¨ì§„ ê²½ë ¥ ì¹´ë“œ</h2>
        <div className="w-16"></div> {/* Spacer */}
      </div>

      <div className="flex-1 overflow-y-auto no-scrollbar space-y-4 pb-20">
        {isLoading ? (
          <div className="text-center mt-20 space-y-4">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
            <p className="text-gray-500">ëŒ€í™” ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ê²½ë ¥ì„ ì •ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</p>
            <p className="text-xs text-gray-400">AIê°€ ë‹¹ì‹ ì˜ ê°•ì ì„ ì°¾ê³  ìˆì–´ìš”!</p>
          </div>
        ) : experiences.length === 0 ? (
          <div className="text-center mt-20 text-gray-500">
            <p>ë¶„ì„ëœ ê²½ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            <p className="text-sm">ëŒ€í™”ë¥¼ ì¡°ê¸ˆ ë” ë‚˜ëˆ„ì–´ ë³¼ê¹Œìš”?</p>
          </div>
        ) : (
          experiences.map((exp, idx) => (
            <div 
              key={exp.id} 
              className="bg-white rounded-xl p-5 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300 transform hover:-translate-y-1"
              style={{ animationDelay: `${idx * 100}ms` }}
            >
              <div className="flex justify-between items-start mb-3">
                <h3 className="font-bold text-lg text-indigo-700">{exp.title}</h3>
                <span className="bg-indigo-50 text-indigo-600 text-xs px-2 py-1 rounded-md font-semibold">STAR ì™„ë£Œ</span>
              </div>
              
              <div className="space-y-3 text-sm text-gray-600">
                <div className="flex gap-2">
                  <span className="font-bold min-w-[30px] text-gray-400">S</span>
                  <p className="bg-gray-50 p-2 rounded flex-1">{exp.situation}</p>
                </div>
                <div className="flex gap-2">
                  <span className="font-bold min-w-[30px] text-gray-400">T</span>
                  <p className="bg-gray-50 p-2 rounded flex-1">{exp.task}</p>
                </div>
                <div className="flex gap-2">
                  <span className="font-bold min-w-[30px] text-gray-400">A</span>
                  <p className="bg-gray-50 p-2 rounded flex-1">{exp.action}</p>
                </div>
                <div className="flex gap-2">
                  <span className="font-bold min-w-[30px] text-indigo-500">R</span>
                  <p className="bg-indigo-50 p-2 rounded flex-1 font-medium text-gray-800">{exp.result}</p>
                </div>
              </div>

              <div className="mt-4 flex flex-wrap gap-2">
                {exp.tags.map((tag, i) => (
                  <span key={i} className="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded-full">#{tag}</span>
                ))}
              </div>
            </div>
          ))
        )}
      </div>

      {!isLoading && experiences.length > 0 && (
        <div className="sticky bottom-0 bg-gradient-to-t from-gray-50 to-transparent pt-4 pb-2">
            <button
            onClick={() => { audioService.playClick(); onNext(); }}
            className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-indigo-700 transition active:scale-95 flex items-center justify-center gap-2"
            >
            <span>ì´ ê²½í—˜ì„ ë³´ì™„í•  í™œë™ ì¶”ì²œë°›ê¸°</span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5">
                <path strokeLinecap="round" strokeLinejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
            </svg>
            </button>
        </div>
      )}
    </div>
  );
};

AnalysisView;

/* --- Bundled from ChatInterface.tsx --- */
import React, { useEffect, useRef, useState } from 'react';




interface ChatInterfaceProps {
  history: Message[];
  setHistory: React.Dispatch<React.SetStateAction<Message[]>>;
  onAnalyze: () => void;
}

const ChatInterface: React.FC<ChatInterfaceProps> = ({ history, setHistory, onAnalyze }) => {
  const [input, setInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const scrollRef = useRef<HTMLDivElement>(null);

  // ìë™ ìŠ¤í¬ë¡¤
  useEffect(() => {
    if (scrollRef.current) {
      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
    }
  }, [history]);

  const handleSend = async () => {
    if (!input.trim() || isLoading) return;

    audioService.playClick();
    const userMsg: Message = {
      id: Date.now().toString(),
      role: 'user',
      text: input,
      timestamp: new Date(),
    };

    setHistory(prev => [...prev, userMsg]);
    setInput('');
    setIsLoading(true);

    try {
      const responseText = await sendChatMessage(history, input);
      const aiMsg: Message = {
        id: (Date.now() + 1).toString(),
        role: 'model',
        text: responseText,
        timestamp: new Date(),
      };
      setHistory(prev => [...prev, aiMsg]);
      audioService.playSuccess(); // AI ì‘ë‹µ ì‹œ ê¸ì •ì  í”¼ë“œë°±
    } catch (error) {
      console.error(error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  return (
    <div className="flex flex-col h-full bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
      {/* í—¤ë” */}
      <div className="bg-indigo-600 p-4 text-white flex justify-between items-center">
        <div>
          <h2 className="font-bold text-lg">ê²½í—˜ ë°œêµ´ ì¸í„°ë·°</h2>
          <p className="text-xs text-indigo-100 opacity-80">ì‚¬ì†Œí•œ ì´ì•¼ê¸°ë„ í¸í•˜ê²Œ í•´ì£¼ì„¸ìš”.</p>
        </div>
        {history.length > 2 && (
          <button 
            onClick={() => { audioService.playClick(); onAnalyze(); }}
            className="bg-white text-indigo-600 px-3 py-1.5 rounded-full text-xs font-bold hover:bg-indigo-50 transition shadow-md animate-pulse"
          >
            ë¶„ì„í•˜ëŸ¬ ê°€ê¸° &rarr;
          </button>
        )}
      </div>

      {/* ì±„íŒ… ì˜ì—­ */}
      <div ref={scrollRef} className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 no-scrollbar">
        {history.length === 0 && (
          <div className="text-center text-gray-400 mt-10 text-sm">
            <p>ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”!</p>
            <p>ìµœê·¼ì— ê°€ì¥ ì¦ê²ê²Œ í–ˆë˜ ì¼ì€ ë¬´ì—‡ì¸ê°€ìš”?</p>
          </div>
        )}
        {history.map((msg) => (
          <div
            key={msg.id}
            className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
          >
            <div
              className={`max-w-[80%] p-3 rounded-2xl text-sm leading-relaxed shadow-sm ${
                msg.role === 'user'
                  ? 'bg-indigo-500 text-white rounded-tr-none'
                  : 'bg-white text-gray-800 border border-gray-200 rounded-tl-none'
              }`}
            >
              {msg.text}
            </div>
          </div>
        ))}
        {isLoading && (
          <div className="flex justify-start">
            <div className="bg-white p-3 rounded-2xl rounded-tl-none border border-gray-200 shadow-sm">
              <div className="flex space-x-1">
                <div className="w-2 h-2 bg-gray-300 rounded-full animate-bounce"></div>
                <div className="w-2 h-2 bg-gray-300 rounded-full animate-bounce delay-75"></div>
                <div className="w-2 h-2 bg-gray-300 rounded-full animate-bounce delay-150"></div>
              </div>
            </div>
          </div>
        )}
      </div>

      {/* ì…ë ¥ ì˜ì—­ */}
      <div className="p-3 bg-white border-t border-gray-100">
        <div className="flex items-center space-x-2">
          <input
            type="text"
            value={input}
            onChange={(e) => setInput(e.target.value)}
            onKeyDown={handleKeyDown}
            placeholder="ì˜ˆ: í¸ì˜ì  ì•Œë°”í•  ë•Œ ì§„ìƒ ì†ë‹˜ì„ ë‹¬ëœ ì ì´ ìˆì–´ìš”..."
            className="flex-1 border border-gray-200 rounded-full px-4 py-3 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition text-sm"
          />
          <button
            onClick={handleSend}
            disabled={!input.trim() || isLoading}
            className="bg-indigo-600 text-white p-3 rounded-full hover:bg-indigo-700 disabled:bg-gray-300 transition shadow-md"
          >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5">
              <path strokeLinecap="round" strokeLinejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  );
};

ChatInterface;

/* --- Bundled from RecommendationView.tsx --- */
import React from 'react';



interface RecommendationViewProps {
  activities: Activity[];
  isLoading: boolean;
  onReset: () => void;
  onBack: () => void;
}

const RecommendationView: React.FC<RecommendationViewProps> = ({ activities, isLoading, onReset, onBack }) => {
  return (
    <div className="flex flex-col h-full space-y-4">
      <div className="flex items-center justify-between">
         <button onClick={() => { audioService.playClick(); onBack(); }} className="text-gray-500 hover:text-gray-800 text-sm font-medium">
          &larr; ë’¤ë¡œê°€ê¸°
        </button>
        <h2 className="text-xl font-bold text-gray-800">ë‹¨ê¸° ì„±ì¥ ë¶€ìŠ¤í„° ğŸš€</h2>
        <div className="w-16"></div>
      </div>

      <div className="flex-1 overflow-y-auto no-scrollbar space-y-4 pb-20">
        {isLoading ? (
          <div className="text-center mt-20 space-y-4">
            <div className="animate-pulse flex justify-center space-x-2">
                <div className="h-4 w-4 bg-yellow-400 rounded-full"></div>
                <div className="h-4 w-4 bg-yellow-400 rounded-full"></div>
                <div className="h-4 w-4 bg-yellow-400 rounded-full"></div>
            </div>
            <p className="text-gray-500">ë‹¹ì‹ ì˜ ì„±ì¥ì„ ìœ„í•œ ë§ì¶¤í˜• í™œë™ì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...</p>
          </div>
        ) : activities.length === 0 ? (
          <div className="text-center mt-20 text-gray-500">ì¶”ì²œí•  í™œë™ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>
        ) : (
          activities.map((act, idx) => (
            <div 
              key={act.id}
              className="bg-white rounded-xl p-5 shadow-sm border border-gray-100 relative overflow-hidden group hover:shadow-lg transition-all"
            >
              {/* Decorative accent */}
              <div className={`absolute left-0 top-0 bottom-0 w-1.5 ${
                act.type === 'Lecture' ? 'bg-blue-400' :
                act.type === 'Campaign' ? 'bg-green-400' : 'bg-orange-400'
              }`}></div>

              <div className="flex justify-between items-start mb-2 pl-2">
                <span className={`text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded ${
                   act.type === 'Lecture' ? 'bg-blue-50 text-blue-600' :
                   act.type === 'Campaign' ? 'bg-green-50 text-green-600' : 'bg-orange-50 text-orange-600'
                }`}>
                  {act.type === 'Lecture' ? 'ì˜¨ë¼ì¸ ê°•ì˜' : act.type === 'Campaign' ? 'ìº í˜ì¸ ì°¸ì—¬' : 'ë‹¨ê¸° ë´‰ì‚¬'}
                </span>
                <span className="text-xs font-semibold text-gray-400 bg-gray-100 px-2 py-0.5 rounded-full">
                  â±ï¸ {act.duration}
                </span>
              </div>

              <h3 className="font-bold text-lg text-gray-800 mb-2 pl-2">{act.title}</h3>
              <p className="text-sm text-gray-600 mb-4 pl-2 leading-relaxed">{act.description}</p>
              
              <div className="bg-gray-50 p-3 rounded-lg ml-2">
                <p className="text-xs font-bold text-gray-500 mb-1">ğŸ ì´ë ¥ì„œ í™œìš© í¬ì¸íŠ¸</p>
                <p className="text-sm text-indigo-600 font-medium">{act.benefit}</p>
              </div>
              
              <button 
                onClick={() => { audioService.playClick(); alert('ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” í•´ë‹¹ í™œë™ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤!'); }}
                className="mt-4 w-full border border-gray-200 text-gray-600 py-2 rounded-lg text-sm font-semibold hover:bg-gray-50 transition ml-1"
              >
                ì°¸ì—¬í•˜ëŸ¬ ê°€ê¸°
              </button>
            </div>
          ))
        )}
      </div>
        
      {!isLoading && (
        <div className="sticky bottom-0 bg-gradient-to-t from-gray-50 to-transparent pt-4 pb-2">
            <button
                onClick={() => { audioService.playClick(); onReset(); }}
                className="w-full bg-white text-gray-500 border border-gray-300 py-3 rounded-xl font-bold hover:bg-gray-50 transition"
            >
                ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
        </div>
      )}
    </div>
  );
};

RecommendationView;

/* --- Bundled from audioService.ts --- */
// Web Audio APIë¥¼ ì‚¬ìš©í•œ íš¨ê³¼ìŒ ì„œë¹„ìŠ¤
// ë³„ë„ì˜ mp3 íŒŒì¼ ì—†ì´ ì½”ë“œë¡œ ì†Œë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

class AudioService {
  private audioContext: AudioContext | null = null;

  constructor() {
    // ë¸Œë¼ìš°ì € í˜¸í™˜ì„±ì„ ìœ„í•œ ì´ˆê¸°í™”
    const AudioContextClass = window.AudioContext || (window as any).webkitAudioContext;
    if (AudioContextClass) {
      this.audioContext = new AudioContextClass();
    }
  }

  private ensureContext() {
    if (this.audioContext && this.audioContext.state === 'suspended') {
      this.audioContext.resume();
    }
    if (!this.audioContext) {
        const AudioContextClass = window.AudioContext || (window as any).webkitAudioContext;
        if (AudioContextClass) {
            this.audioContext = new AudioContextClass();
        }
    }
  }

  // 1. ê¸ì •ì ì¸ ì•Œë¦¼ìŒ (ê²½í—˜ ë°œêµ´ ì„±ê³µ ì‹œ)
  playSuccess() {
    this.ensureContext();
    if (!this.audioContext) return;

    const oscillator = this.audioContext.createOscillator();
    const gainNode = this.audioContext.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(this.audioContext.destination);

    // ë„-ë¯¸-ì†” ëŠë‚Œì˜ í™”ìŒ ì•„ë¥´í˜ì§€ì˜¤
    const now = this.audioContext.currentTime;
    
    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(523.25, now); // C5
    oscillator.frequency.exponentialRampToValueAtTime(659.25, now + 0.1); // E5
    oscillator.frequency.exponentialRampToValueAtTime(783.99, now + 0.2); // G5

    gainNode.gain.setValueAtTime(0.1, now);
    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.4);

    oscillator.start(now);
    oscillator.stop(now + 0.4);
  }

  // 2. ê°€ë²¼ìš´ í´ë¦­ìŒ (ë©”ì‹œì§€ ì „ì†¡ ë“±)
  playClick() {
    this.ensureContext();
    if (!this.audioContext) return;

    const oscillator = this.audioContext.createOscillator();
    const gainNode = this.audioContext.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(this.audioContext.destination);

    const now = this.audioContext.currentTime;
    
    oscillator.type = 'triangle';
    oscillator.frequency.setValueAtTime(800, now);
    gainNode.gain.setValueAtTime(0.05, now);
    gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1);

    oscillator.start(now);
    oscillator.stop(now + 0.1);
  }

  // 3. í˜ì´ì§€ ì „í™˜ìŒ (Shush íš¨ê³¼)
  playTransition() {
    this.ensureContext();
    if (!this.audioContext) return;
    
    // White noise buffer logic could go here, but keeping it simple with oscillator
    const oscillator = this.audioContext.createOscillator();
    const gainNode = this.audioContext.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(this.audioContext.destination);

    const now = this.audioContext.currentTime;
    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(200, now);
    oscillator.frequency.linearRampToValueAtTime(400, now + 0.2);
    
    gainNode.gain.setValueAtTime(0.02, now);
    gainNode.gain.linearRampToValueAtTime(0, now + 0.2);

    oscillator.start(now);
    oscillator.stop(now + 0.2);
  }
}

const audioService = new AudioService();

/* --- Bundled from geminiService.ts --- */
import { GoogleGenAI, Type, Schema } from "@google/genai";


// API í‚¤ê°€ ì—†ìœ¼ë©´ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ìš°ì•„í•˜ê²Œ í•˜ê¸° ìœ„í•œ ì•ˆì „ì¥ì¹˜
const apiKey = process.env.API_KEY || '';

// ì¸ìŠ¤í„´ìŠ¤ ìƒì„± í•¨ìˆ˜
const getAI = () => new GoogleGenAI({ apiKey });

// 1. ê²½í—˜ ë°œêµ´ ì±„íŒ… ì‹œìŠ¤í…œ
// ì‚¬ìš©ìì˜ ì‚¬ì†Œí•œ ì´ì•¼ê¸°ë„ ê²½ë ¥ìœ¼ë¡œ ì—°ê²°ë  ìˆ˜ ìˆê²Œ ìœ ë„í•˜ëŠ” í˜ë¥´ì†Œë‚˜
const SYSTEM_INSTRUCTION_CHAT = `
ë‹¹ì‹ ì€ 'ë‚˜ë„ ëª°ëë˜ ë‚˜ë€ ì‚¬ëŒ' ì„œë¹„ìŠ¤ì˜ AI ì»¤ë¦¬ì–´ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. 
ì£¼ ì‚¬ìš©ìëŠ” ê³ ë“±í•™ìƒ, ëŒ€í•™ìƒ, ì·¨ì¤€ìƒì…ë‹ˆë‹¤.
ëª©í‘œ: ì‚¬ìš©ìê°€ "ì“¸ ë§Œí•œ ê²½í—˜ì´ ì—†ë‹¤"ê³  ëŠë‚„ ë•Œ, ëŒ€í™”ë¥¼ í†µí•´ ìˆ¨ê²¨ì§„ ì—­ëŸ‰ì´ë‚˜ ê²½í—˜ì„ ì°¾ì•„ë‚´ì„¸ìš”.
ì–´ì¡°: ì¹œì ˆí•˜ê³ , ê²©ë ¤í•˜ë©°, í˜¸ê¸°ì‹¬ì´ ë§ìŠµë‹ˆë‹¤. ì§ˆë¬¸ì€ í•œ ë²ˆì— í•˜ë‚˜ì”©ë§Œ í•˜ì„¸ìš”.
ì—­í• :
1. ì‚¬ìš©ìì˜ ì¼ìƒì ì¸ í™œë™(ì•Œë°”, ë™ì•„ë¦¬, ê²Œì„, ì·¨ë¯¸ ë“±)ì— ëŒ€í•´ ë¬¼ì–´ë³´ì„¸ìš”.
2. ê·¸ í™œë™ì—ì„œ ì–´ë–¤ ë¬¸ì œë¥¼ í•´ê²°í–ˆëŠ”ì§€, ì–´ë–¤ ì—­í• ì„ í–ˆëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ íŒŒê³ ë“œì„¸ìš”.
3. ì¹­ì°¬ì„ ë§ì´ í•´ì£¼ì„¸ìš”. "ì™€, ê·¸ê±´ ì •ë§ ëŒ€ë‹¨í•œ ë¦¬ë”ì‹­ì¸ë°ìš”?" ê°™ì´ ë°˜ì‘í•˜ì„¸ìš”.
ì ˆëŒ€ ì´ë ¥ì„œ ì–‘ì‹ì„ ì§ì ‘ ì‘ì„±í•´ì£¼ì§€ ë§ê³ , ëŒ€í™”ë¥¼ í†µí•´ 'ì¬ë£Œ'ë¥¼ ëª¨ìœ¼ëŠ” ë° ì§‘ì¤‘í•˜ì„¸ìš”.
`;

const sendChatMessage = async (history: Message[], newMessage: string): Promise<string> => {
  if (!apiKey) return "API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
  
  try {
    const ai = getAI();
    // ì´ì „ ëŒ€í™” ë‚´ìš©ì„ ì»¨í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
    const chatHistory = history.map(msg => ({
      role: msg.role,
      parts: [{ text: msg.text }]
    }));

    const chat = ai.chats.create({
      model: 'gemini-2.5-flash',
      config: {
        systemInstruction: SYSTEM_INSTRUCTION_CHAT,
        thinkingConfig: { thinkingBudget: 0 } // ë¹ ë¥¸ ì‘ë‹µì„ ìœ„í•´ thinking ë”
      },
      history: chatHistory
    });

    const result = await chat.sendMessage({ message: newMessage });
    return result.text || "ì£„ì†¡í•´ìš”, ì ì‹œ ìƒê°ì´ ì—‰ì¼°ì–´ìš”. ë‹¤ì‹œ ë§ì”€í•´ ì£¼ì‹œê² ì–´ìš”?";
  } catch (error) {
    console.error("Chat Error:", error);
    return "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
  }
};

// 2. ê²½ë ¥ ì¬í•´ì„ (Analysis)
// ëŒ€í™” ê¸°ë¡ì„ ë°”íƒ•ìœ¼ë¡œ STAR ê¸°ë²•ìœ¼ë¡œ ì •ë¦¬ëœ JSON ë°ì´í„° ë°˜í™˜
const EXPERIENCE_SCHEMA: Schema = {
  type: Type.ARRAY,
  items: {
    type: Type.OBJECT,
    properties: {
      title: { type: Type.STRING, description: "ê²½í—˜ì˜ í•œ ì¤„ ìš”ì•½ ì œëª©" },
      situation: { type: Type.STRING, description: "STAR ê¸°ë²•ì˜ S: ìƒí™©" },
      task: { type: Type.STRING, description: "STAR ê¸°ë²•ì˜ T: ê³¼ì œ/ëª©í‘œ" },
      action: { type: Type.STRING, description: "STAR ê¸°ë²•ì˜ A: êµ¬ì²´ì  í–‰ë™" },
      result: { type: Type.STRING, description: "STAR ê¸°ë²•ì˜ R: ê²°ê³¼/ë°°ìš´ì " },
      tags: { 
        type: Type.ARRAY, 
        items: { type: Type.STRING },
        description: "ê´€ë ¨ ì—­ëŸ‰ íƒœê·¸ (ì˜ˆ: ì†Œí†µëŠ¥ë ¥, ë¬¸ì œí•´ê²°)" 
      }
    },
    required: ["title", "situation", "task", "action", "result", "tags"]
  }
};

const analyzeExperiences = async (history: Message[]): Promise<Experience[]> => {
  if (!apiKey) throw new Error("API Key missing");

  const conversationText = history.map(m => `${m.role}: ${m.text}`).join('\n');
  const prompt = `
    ë‹¤ìŒì€ ì‚¬ìš©ìì™€ì˜ ëŒ€í™” ë‚´ìš©ì…ë‹ˆë‹¤. 
    ì´ ëŒ€í™”ì—ì„œ ì‚¬ìš©ìê°€ ê°€ì§„ ì˜ë¯¸ ìˆëŠ” ê²½í—˜ì„ ì¶”ì¶œí•˜ì—¬ ì´ë ¥ì„œì— ì“¸ ìˆ˜ ìˆëŠ” STAR(Situation, Task, Action, Result) ê¸°ë²•ìœ¼ë¡œ ì •ë¦¬í•´ì£¼ì„¸ìš”.
    ìµœì†Œ 2ê°œ ì´ìƒì˜ ê²½í—˜ì„ ì°¾ì•„ì£¼ì„¸ìš”.
    
    ëŒ€í™” ë‚´ìš©:
    ${conversationText}
  `;

  try {
    const ai = getAI();
    const result = await ai.models.generateContent({
      model: 'gemini-2.5-flash',
      contents: prompt,
      config: {
        responseMimeType: "application/json",
        responseSchema: EXPERIENCE_SCHEMA,
      }
    });

    const jsonText = result.text;
    if (!jsonText) return [];
    
    const parsed = JSON.parse(jsonText);
    // ID ìƒì„±
    return parsed.map((item: any, index: number) => ({
      ...item,
      id: `exp-${Date.now()}-${index}`
    }));

  } catch (error) {
    console.error("Analysis Error:", error);
    return [];
  }
};

// 3. ë‹¨ê¸° ì„±ì¥ ì¶”ì²œ (Recommendation)
// ë¶€ì¡±í•œ ê²½í—˜ì„ ì±„ìš¸ ìˆ˜ ìˆëŠ” ê°€ìƒì˜ ì¶”ì²œ í™œë™ ìƒì„±
const RECOMMENDATION_SCHEMA: Schema = {
  type: Type.ARRAY,
  items: {
    type: Type.OBJECT,
    properties: {
      title: { type: Type.STRING },
      type: { type: Type.STRING, enum: ["Lecture", "Campaign", "Volunteering"] },
      duration: { type: Type.STRING },
      description: { type: Type.STRING },
      benefit: { type: Type.STRING }
    },
    required: ["title", "type", "duration", "description", "benefit"]
  }
};

const getRecommendations = async (experiences: Experience[]): Promise<Activity[]> => {
  if (!apiKey) throw new Error("API Key missing");

  const existingTags = experiences.flatMap(e => e.tags).join(", ");
  const prompt = `
    ì‚¬ìš©ìëŠ” í˜„ì¬ ë‹¤ìŒê³¼ ê°™ì€ ì—­ëŸ‰/ê²½í—˜ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤: [${existingTags}].
    ì´ ì‚¬ìš©ìì—ê²Œ ë¶€ì¡±í•œ ë¶€ë¶„ì„ ë³´ì™„í•˜ê±°ë‚˜ ê°•ì ì„ ê°•í™”í•  ìˆ˜ ìˆëŠ”, 
    2ì¼ì—ì„œ 5ì¼ ì´ë‚´ì— ì™„ë£Œ ê°€ëŠ¥í•œ 'êµ¬ì²´ì ì¸' ë‹¨ê¸° í™œë™ 3ê°€ì§€ë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.
    
    í™œë™ ìœ í˜•ì€ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤:
    1. Lecture: ì˜¨ë¼ì¸ ë‹¨ê¸° ê°•ì˜ (ì˜ˆ: 3ì¼ ì™„ì„± ë§ˆì¼€íŒ… ê¸°ì´ˆ)
    2. Campaign: ì˜¨ë¼ì¸ ì°¸ì—¬ ìº í˜ì¸ (ì˜ˆ: ë°ì´í„° ë¼ë²¨ë§ ì°¸ì—¬, ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬)
    3. Volunteering: ë‹¨ê¸° ë´‰ì‚¬ (ì˜ˆ: ë²ˆì—­ ë´‰ì‚¬)
    
    ëŒ€í•œë¯¼êµ­ í™˜ê²½ì— ë§ëŠ” ì‹¤ì§ˆì ì¸ í™œë™ì„ ì¶”ì²œí•´ì£¼ì„¸ìš”.
  `;

  try {
    const ai = getAI();
    const result = await ai.models.generateContent({
      model: 'gemini-2.5-flash',
      contents: prompt,
      config: {
        responseMimeType: "application/json",
        responseSchema: RECOMMENDATION_SCHEMA,
      }
    });

    const jsonText = result.text;
    if (!jsonText) return [];

    const parsed = JSON.parse(jsonText);
    return parsed.map((item: any, index: number) => ({
      ...item,
      id: `act-${Date.now()}-${index}`
    }));
  } catch (error) {
    console.error("Recommendation Error:", error);
    return [];
  }
};

/* --- Bundled from App.tsx --- */
import React, { useState } from 'react';







const App: React.FC = () => {
  const [view, setView] = useState<ViewState>('onboarding');
  const [history, setHistory] = useState<Message[]>([]);
  const [experiences, setExperiences] = useState<Experience[]>([]);
  const [recommendations, setRecommendations] = useState<Activity[]>([]);
  const [isProcessing, setIsProcessing] = useState(false);

  // ë·° ì „í™˜ í—¬í¼ (ì†Œë¦¬ ì¬ìƒ í¬í•¨)
  const changeView = (newView: ViewState) => {
    audioService.playTransition();
    setView(newView);
  };

  // 1. ë¶„ì„ ì‹œì‘ (Chat -> Analysis)
  const handleAnalyze = async () => {
    changeView('analysis');
    setIsProcessing(true);
    try {
      const results = await analyzeExperiences(history);
      setExperiences(results);
      if (results.length > 0) audioService.playSuccess();
    } catch (e) {
      console.error(e);
    } finally {
      setIsProcessing(false);
    }
  };

  // 2. ì¶”ì²œ ë°›ê¸° (Analysis -> Recommendation)
  const handleRecommend = async () => {
    changeView('recommendation');
    setIsProcessing(true);
    try {
      const results = await getRecommendations(experiences);
      setRecommendations(results);
      if (results.length > 0) audioService.playSuccess();
    } catch (e) {
      console.error(e);
    } finally {
      setIsProcessing(false);
    }
  };

  // 3. ë¦¬ì…‹
  const handleReset = () => {
    setHistory([]);
    setExperiences([]);
    setRecommendations([]);
    changeView('onboarding');
  };

  return (
    <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4">
      <div className="w-full max-w-md bg-gray-50 h-[800px] max-h-[90vh] rounded-[2rem] shadow-2xl overflow-hidden border-4 border-white flex flex-col relative">
        
        {/* ì˜¨ë³´ë”© í™”ë©´ */}
        {view === 'onboarding' && (
          <div className="flex-1 flex flex-col items-center justify-center p-8 bg-gradient-to-br from-indigo-500 to-purple-600 text-white text-center">
            <div className="mb-6 animate-bounce">
              <span className="text-6xl">ğŸŒ±</span>
            </div>
            <h1 className="text-3xl font-bold mb-2">ë‚˜ë„ ëª°ëë˜<br/>ë‚˜ë€ ì‚¬ëŒ</h1>
            <p className="text-indigo-100 mb-10 text-sm opacity-90 leading-relaxed">
              ê²½í—˜ì´ ì—†ì–´ì„œ ëª» ì“°ëŠ”ê²Œ ì•„ë‹ˆë¼<br/>
              ë°œê²¬í•˜ì§€ ëª»í•´ì„œ ëª» ì“°ëŠ” ê±°ì˜ˆìš”.<br/>
              AIì™€ ëŒ€í™”í•˜ë©° ë‹¹ì‹ ì˜ ë³´ì„ì„ ì°¾ì•„ë³´ì„¸ìš”.
            </p>
            <button
              onClick={() => { audioService.playClick(); changeView('chat'); }}
              className="w-full bg-white text-indigo-600 py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-indigo-50 transition transform active:scale-95"
            >
              ë‚´ ê²½í—˜ ì°¾ìœ¼ëŸ¬ ê°€ê¸°
            </button>
          </div>
        )}

        {/* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */}
        {view !== 'onboarding' && (
          <div className="flex-1 flex flex-col p-4 h-full">
            {view === 'chat' && (
              <ChatInterface 
                history={history} 
                setHistory={setHistory} 
                onAnalyze={handleAnalyze} 
              />
            )}
            
            {view === 'analysis' && (
              <AnalysisView 
                experiences={experiences} 
                isLoading={isProcessing} 
                onNext={handleRecommend}
                onBack={() => changeView('chat')}
              />
            )}

            {view === 'recommendation' && (
              <RecommendationView 
                activities={recommendations} 
                isLoading={isProcessing} 
                onReset={handleReset}
                onBack={() => changeView('analysis')}
              />
            )}
          </div>
        )}

        {/* í•˜ë‹¨ ì§„í–‰ ìƒíƒœ í‘œì‹œì¤„ (ì‹¬ë¦¬ì  ì•ˆì •ê° ì œê³µ) */}
        {view !== 'onboarding' && (
          <div className="bg-white p-4 border-t border-gray-100 flex justify-center space-x-2">
            <div className={`h-1.5 rounded-full transition-all duration-500 ${view === 'chat' ? 'w-8 bg-indigo-500' : 'w-2 bg-gray-200'}`}></div>
            <div className={`h-1.5 rounded-full transition-all duration-500 ${view === 'analysis' ? 'w-8 bg-indigo-500' : 'w-2 bg-gray-200'}`}></div>
            <div className={`h-1.5 rounded-full transition-all duration-500 ${view === 'recommendation' ? 'w-8 bg-indigo-500' : 'w-2 bg-gray-200'}`}></div>
          </div>
        )}
      </div>
    </div>
  );
};

App;

/* --- Bundled from types.ts --- */
// ì±„íŒ… ë©”ì‹œì§€ íƒ€ì…
export interface Message {
  id: string;
  role: 'user' | 'model';
  text: string;
  timestamp: Date;
}

// ë°œêµ´ëœ ê²½í—˜ (STAR ê¸°ë²•)
export interface Experience {
  id: string;
  title: string;
  situation: string;
  task: string;
  action: string;
  result: string;
  tags: string[];
}

// ì¶”ì²œ í™œë™
export interface Activity {
  id: string;
  title: string;
  type: 'Lecture' | 'Campaign' | 'Volunteering'; // ê°•ì˜, ìº í˜ì¸, ë´‰ì‚¬
  duration: string; // ì˜ˆ: "3ì¼ ì™„ì„±"
  description: string;
  benefit: string; // ì´ë ¥ì„œì— ì“¸ ìˆ˜ ìˆëŠ” í¬ì¸íŠ¸
}

// í™”ë©´ ìƒíƒœ
export type ViewState = 'onboarding' | 'chat' | 'analysis' | 'recommendation';

/* --- Bundled from vite.config.ts --- */
import path from 'path';
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';

defineConfig(({ mode }) => {
    const env = loadEnv(mode, '.', '');
    return {
      server: {
        port: 3000,
        host: '0.0.0.0',
      },
      plugins: [react()],
      define: {
        'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY),
        'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY)
      },
      resolve: {
        alias: {
          '@': path.resolve(__dirname, '.'),
        }
      }
    };
});


/* --- Bundled from index.tsx --- */
import React from 'react';
import ReactDOM from 'react-dom/client';


const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

    </script>
    <script>
      window.addEventListener('load', function() {
        if (window.Babel) {
          window.Babel.transformScriptTags();
        }
      });
    </script>
    
</body>
</html>